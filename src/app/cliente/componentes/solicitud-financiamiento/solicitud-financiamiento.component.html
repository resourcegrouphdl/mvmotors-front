<div class="min-h-screen bg-gray-50 py-8">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        Solicitud de Financiamiento de Moto
      </h1>
      <div class="flex items-center space-x-4">
        <div class="flex-1 bg-gray-200 rounded-full h-2">
          <div
            class="bg-blue-600 h-2 rounded-full transition-all duration-300"
            [style.width.%]="progreso"
          ></div>
        </div>
        <span class="text-sm font-medium text-gray-700">
          Paso {{ pasoActual }} de {{ totalPasos }}
        </span>
      </div>
    </div>

    <!-- Navegaci√≥n de pasos -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <nav class="flex justify-between">
        <button
          *ngFor="let paso of pasos; let i = index"
          (click)="irAPaso(i + 1)"
          [class]="getClasePaso(i + 1)"
          [disabled]="!puedeIrAPaso(i + 1)"
          class="flex-1 text-center py-2 px-4 rounded-lg font-medium transition-colors duration-200 mx-1"
        >
          {{ paso }}
        </button>
      </nav>
    </div>

    <!-- Contenido del formulario -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <!-- Loading -->
      <div *ngIf="cargando" class="text-center py-12">
        <div
          class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"
        ></div>
        <p class="mt-4 text-gray-600">{{ mensajeCarga }}</p>
      </div>

      <!-- Paso 1: Datos del Titular -->
      <div *ngIf="pasoActual === 1 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Datos del Titular
        </h2>

        <form [formGroup]="formTitular" class="space-y-6">
          <!-- DNI y b√∫squeda con indicadores -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Tipo de Documento *</label
              >
              <select
                formControlName="documentType"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="DNI">DNI</option>
                <option value="CE">Carnet de Extranjer√≠a</option>
                <option value="PASAPORTE">Pasaporte</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >N√∫mero de Documento *</label
              >
              <div class="relative">
                <input
                  type="text"
                  formControlName="documentNumber"
                  (blur)="buscarClienteExistente()"
                  maxlength="12"
                  placeholder="Ingrese 8 d√≠gitos"
                  class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />

                <!-- Indicador de consulta RENIEC -->
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <div
                    *ngIf="consultandoDNI"
                    class="animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"
                  ></div>
                  <svg
                    *ngIf="
                      !consultandoDNI &&
                      ultimaConsultaDNI ===
                        formTitular.get('documentNumber')?.value &&
                      ultimaConsultaDNI.length === 8
                    "
                    class="h-4 w-4 text-green-500"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </div>
              </div>

              <!-- Mensaje de estado DNI -->
              <div class="mt-1 text-xs">
                <span *ngIf="consultandoDNI" class="text-blue-600">
                  üîç Consultando en RENIEC...
                </span>
                <span
                  *ngIf="
                    !consultandoDNI &&
                    ultimaConsultaDNI ===
                      formTitular.get('documentNumber')?.value &&
                    ultimaConsultaDNI.length === 8
                  "
                  class="text-green-600"
                >
                  ‚úÖ Datos obtenidos de RENIEC
                </span>
                <span
                  *ngIf="
                    !consultandoDNI &&
                    formTitular.get('documentNumber')?.value?.length === 8 &&
                    formTitular.get('documentType')?.value !== 'DNI'
                  "
                  class="text-gray-500"
                >
                  ‚ÑπÔ∏è Solo se consulta RENIEC para DNI
                </span>
              </div>
            </div>

            <div class="flex items-end">
              <button
                type="button"
                (click)="consultarDNITitular()"
                [disabled]="
                  consultandoDNI ||
                  formTitular.get('documentNumber')?.value?.length !== 8
                "
                class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span *ngIf="!consultandoDNI">üîç Consultar RENIEC</span>
                <span *ngIf="consultandoDNI">
                  <span
                    class="animate-spin inline-block h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"
                  ></span>
                  Consultando...
                </span>
              </button>
            </div>
          </div>

          <!-- Alerta cliente existente -->
          <div
            *ngIf="clienteExistente"
            class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"
          >
            <div class="flex items-start">
              <div class="flex-shrink-0">
                <svg
                  class="h-5 w-5 text-yellow-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">
                  Cliente encontrado en base de datos
                </h3>
                <p class="mt-1 text-sm text-yellow-700">
                  {{ clienteExistente.nombres }}
                  {{ clienteExistente.apellidoPaterno }}
                  ya est√° registrado. Los datos se han cargado autom√°ticamente.
                </p>
              </div>
            </div>
          </div>
          <!-- Alerta RENIEC exitoso -->
          <div
            *ngIf="
              !clienteExistente &&
              ultimaConsultaDNI === formTitular.get('documentNumber')?.value &&
              ultimaConsultaDNI.length === 8
            "
            class="bg-green-50 border border-green-200 rounded-lg p-4"
          >
            <div class="flex items-start">
              <div class="flex-shrink-0">
                <svg
                  class="h-5 w-5 text-green-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-green-800">
                  Datos consultados en RENIEC
                </h3>
                <p class="mt-1 text-sm text-green-700">
                  Los nombres y apellidos se han completado autom√°ticamente
                  desde RENIEC.
                </p>
              </div>
            </div>
          </div>

          <!-- Datos personales -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Nombres *</label
              >
              <input
                type="text"
                formControlName="nombres"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Apellido Paterno *</label
              >
              <input
                type="text"
                formControlName="apellidoPaterno"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Apellido Materno *</label
              >
              <input
                type="text"
                formControlName="apellidoMaterno"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Estado Civil *</label
              >
              <select
                formControlName="estadoCivil"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option value="soltero">Soltero(a)</option>
                <option value="casado">Casado(a)</option>
                <option value="conviviente">Conviviente</option>
                <option value="divorciado">Divorciado(a)</option>
                <option value="viudo">Viudo(a)</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Email *</label
              >
              <input
                type="email"
                formControlName="email"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Fecha de Nacimiento *</label
              >
              <input
                type="date"
                formControlName="fechaNacimiento"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <!-- Ubicaci√≥n -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Departamento *</label
              >
              <select
                formControlName="departamento"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option *ngFor="let dep of departamentos" [value]="dep">
                  {{ dep }}
                </option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Provincia *</label
              >
              <input
                type="text"
                formControlName="provincia"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Distrito</label
              >
              <input
                type="text"
                formControlName="distrito"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Direcci√≥n *</label
            >
            <input
              type="text"
              formControlName="direccion"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </div>

          <!-- Contacto -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Tel√©fono Principal *</label
              >
              <input
                type="tel"
                formControlName="telefono1"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Tel√©fono Secundario</label
              >
              <input
                type="tel"
                formControlName="telefono2"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <!-- Datos laborales -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Ocupaci√≥n *</label
              >
              <select
                formControlName="ocupacion"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option value="dependiente">Dependiente</option>
                <option value="independiente">Independiente</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Rango de Ingresos *</label
              >
              <select
                formControlName="rangoIngresos"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option value="1000-1500">S/. 1,000 - S/. 1,500</option>
                <option value="1500-2000">S/. 1,500 - S/. 2,000</option>
                <option value="2000+">S/. 2,000 a m√°s</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Tipo de Vivienda *</label
              >
              <select
                formControlName="tipoVivienda"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option value="alquilado">Alquilado</option>
                <option value="familiar">Familiar</option>
                <option value="propio">Propio</option>
              </select>
            </div>
          </div>

          <!-- Licencia de conducir -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Licencia de Conducir *</label
              >
              <select
                formControlName="licenciaConducir"
                (change)="onLicenciaChange($event)"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar...</option>
                <option value="vigente">Vigente</option>
                <option value="vencido">Vencido</option>
                <option value="noTengo">No tengo</option>
              </select>
            </div>

            <div *ngIf="mostrarNumeroLicencia">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >N√∫mero de Licencia</label
              >
              <input
                type="text"
                formControlName="numeroLicencia"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>
        </form>
      </div>

      <!-- Paso 2: Archivos del Titular -->
      <div *ngIf="pasoActual === 2 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Documentos del Titular
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Selfie -->
          <!-- Selfie con Preview -->
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['selfie']" class="mb-4">
              <img
                [src]="archivosPreview['selfie']"
                alt="Preview Selfie"
                class="mx-auto h-32 w-32 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['selfie']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Selfie en lugar de trabajo *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'selfie')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["selfie"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['selfie']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["selfie"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["selfie"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{ formatFileSize(archivosSeleccionados["selfie"].size) }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('selfie')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- DNI Frente -->
          <!-- DNI Frente con Preview -->
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['dniFrente']" class="mb-4">
              <img
                [src]="archivosPreview['dniFrente']"
                alt="Preview DNI Frente"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['dniFrente']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >DNI Frente *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'dniFrente')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["dniFrente"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['dniFrente']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["dniFrente"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["dniFrente"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{
                        formatFileSize(archivosSeleccionados["dniFrente"].size)
                      }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('dniFrente')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- DNI Trasera -->
          <!-- DNI Frente con Preview -->
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['dniReverso']" class="mb-4">
              <img
                [src]="archivosPreview['dniReverso']"
                alt="Preview DNI Reverso"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['dniReverso']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >DNI Reverso *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'dniReverso')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["dniReverso"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['dniReverso']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["dniReverso"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["dniReverso"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{
                        formatFileSize(archivosSeleccionados["dniReverso"].size)
                      }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('dniReverso')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- Recibo de Servicio -->
          <!--  recivo de servicio -->
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['reciboServicio']" class="mb-4">
              <img
                [src]="archivosPreview['reciboServicio']"
                alt="Preview Recibo de Servicio"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['reciboServicio']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Recibo de Servicio *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'reciboServicio')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["reciboServicio"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['reciboServicio']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["reciboServicio"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["reciboServicio"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{
                        formatFileSize(archivosSeleccionados["reciboServicio"].size)
                      }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('reciboServicio')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- Foto de Fachada -->
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['fachada']" class="mb-4">
              <img
                [src]="archivosPreview['fachada']"
                alt="Preview Fachada"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['fachada']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >DNI Frente *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'fachada')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["fachada"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['fachada']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["fachada"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["fachada"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{
                        formatFileSize(archivosSeleccionados["fachada"].size)
                      }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('fachada')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          <!-- ///////archivos opcionales   -->
           <div
           *ngIf="mostrarCampoLicencia()"
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosPreview['fotoLicenciaFrente']" class="mb-4">
              <img
                [src]="archivosPreview['fotoLicenciaFrente']"
                alt="Preview fotoLicenciaFrente"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosPreview['fotoLicenciaFrente']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Licencia de Conducir </span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelected($event, 'fotoLicenciaFrente')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosSeleccionados["fotoLicenciaFrente"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosSeleccionados['fotoLicenciaFrente']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosSeleccionados["fotoLicenciaFrente"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosSeleccionados["fotoLicenciaFrente"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{
                        formatFileSize(archivosSeleccionados["fotoLicenciaFrente"].size)
                      }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivo('fotoLicenciaFrente')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>


          <!-- ///////archivos opcionales   -->

         <div
  *ngIf="mostrarCampoCertificado()"
  class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
>
  <!-- Preview de imagen si existe y se puede mostrar -->
  <div *ngIf="archivosPreview['certificadoLaboral']" class="mb-4">
    <img
      [src]="archivosPreview['certificadoLaboral']"
      alt="Preview certificadoLaboral"
      class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
    />
  </div>

  <!-- Icono por defecto para archivos sin preview (PDF, Word, etc.) -->
  <div *ngIf="archivosSeleccionados['certificadoLaboral'] && !archivosPreview['certificadoLaboral']" class="mb-4">
    <div class="mx-auto h-32 w-48 bg-gray-100 rounded-lg border-2 border-gray-200 shadow-sm flex items-center justify-center">
      <div class="text-center">
        <span class="text-5xl text-gray-500">
          {{ getFileIcon(archivosSeleccionados['certificadoLaboral']) }}
        </span>
        <p class="text-sm text-gray-600 mt-2 font-medium">{{ getFileTypeName(archivosSeleccionados['certificadoLaboral']) }}</p>
      </div>
    </div>
  </div>

  <!-- √çcono por defecto si no hay archivo seleccionado -->
  <svg
    *ngIf="!archivosSeleccionados['certificadoLaboral']"
    class="mx-auto h-12 w-12 text-gray-400 mb-4"
    stroke="currentColor"
    fill="none"
    viewBox="0 0 48 48"
  >
    <path
      d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>

  <label class="cursor-pointer">
    <span class="block text-sm font-medium text-gray-900 mb-1">Certificado Laboral</span>
    <span class="block text-xs text-gray-500 mb-4">PNG, JPG, PDF, DOC, DOCX, XLS, XLSX, TXT hasta 10MB</span>
    <input
      type="file"
      (change)="onFileSelected($event, 'certificadoLaboral')"
      accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/plain"
      class="sr-only"
    />
    <span
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
    >
      {{
        archivosSeleccionados["certificadoLaboral"]
          ? "Cambiar archivo"
          : "Seleccionar archivo"
      }}
    </span>
  </label>

  <!-- Informaci√≥n del archivo seleccionado -->
  <div
    *ngIf="archivosSeleccionados['certificadoLaboral']"
    class="mt-3 p-2 bg-green-50 rounded-lg"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <span class="text-green-600 text-lg">{{
          getFileIcon(archivosSeleccionados["certificadoLaboral"])
        }}</span>
        <div class="text-sm">
          <p class="text-green-800 font-medium">
            {{ archivosSeleccionados["certificadoLaboral"].name }}
          </p>
          <p class="text-green-600 text-xs">
            {{ formatFileSize(archivosSeleccionados["certificadoLaboral"].size) }}
            ‚Ä¢ {{ getFileTypeName(archivosSeleccionados["certificadoLaboral"]) }}
          </p>
        </div>
      </div>
      <button
        type="button"
        (click)="eliminarArchivo('certificadoLaboral')"
        class="text-red-500 hover:text-red-700 text-sm"
      >
        üóëÔ∏è Eliminar
      </button>
    </div>
  </div>
</div>
         

        </div>
      </div>

      <!-- Paso 3: Referencias -->
      <!-- Paso 3: Referencias -->
      <div *ngIf="pasoActual === 5 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Referencias Personales
        </h2>

        <!-- CORRECCI√ìN: Agregar [formGroup] padre -->
        <form [formGroup]="formReferencias">
          <div formArrayName="referencias">
            <div
              *ngFor="
                let referencia of getReferenciasFormArray().controls;
                let i = index
              "
              [formGroupName]="i"
              class="bg-gray-50 rounded-lg p-6 mb-4"
            >
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">
                  Referencia {{ i + 1 }}
                </h3>
                <button
                  *ngIf="getReferenciasFormArray().length > 1"
                  type="button"
                  (click)="eliminarReferencia(i)"
                  class="text-red-600 hover:text-red-800 text-sm font-medium"
                >
                  Eliminar
                </button>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Nombres *</label
                  >
                  <input
                    type="text"
                    formControlName="nombre"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Apellidos *</label
                  >
                  <input
                    type="text"
                    formControlName="apellidos"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Tel√©fono *</label
                  >
                  <input
                    type="tel"
                    formControlName="telefono"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Parentesco *</label
                  >
                  <select
                    formControlName="parentesco"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <option value="">Seleccionar...</option>
                    <option value="hermano">Hermano(a)</option>
                    <option value="padre">Padre</option>
                    <option value="madre">Madre</option>
                    <option value="tio">T√≠o(a)</option>
                    <option value="primo">Primo(a)</option>
                    <option value="amigo">Amigo(a)</option>
                    <option value="vecino">Vecino(a)</option>
                    <option value="compa√±ero_trabajo">
                      Compa√±ero de trabajo
                    </option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <button
            type="button"
            (click)="agregarReferencia()"
            [disabled]="getReferenciasFormArray().length >= 3"
            class="w-full mt-4 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            + Agregar otra referencia (m√°ximo 3)
          </button>
        </form>
      </div>
      <!-- Paso 4: Datos del Fiador -->
      <div *ngIf="pasoActual === 3 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Datos del Fiador/Aval (Opcional)
        </h2>

        <!-- Toggle para fiador -->
        <div class="mb-6">
          <label class="flex items-center">
            <input
              type="checkbox"
              [(ngModel)]="requiereFiador"
              (change)="toggleFiador($event)"
              class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
            />
            <span class="ml-2 text-sm text-gray-700">¬øRequiere fiador?</span>
          </label>
        </div>

        <div *ngIf="requiereFiador">
          <form [formGroup]="formFiador" class="space-y-6">
            <!-- DNI y b√∫squeda del fiador -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Tipo de Documento *</label
                >
                <select
                  formControlName="documentType"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="DNI">DNI</option>
                  <option value="CE">Carnet de Extranjer√≠a</option>
                  <option value="PASAPORTE">Pasaporte</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >N√∫mero de Documento *</label
                >
                <div class="relative">
                  <input
                    type="text"
                    formControlName="documentNumber"
                    (blur)="buscarFiadorExistente()"
                    maxlength="12"
                    placeholder="Ingrese 8 d√≠gitos"
                    class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />

                  <!-- Indicador de consulta RENIEC Fiador -->
                  <div
                    class="absolute inset-y-0 right-0 pr-3 flex items-center"
                  >
                    <div
                      *ngIf="consultandoDNIFiador"
                      class="animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"
                    ></div>
                    <svg
                      *ngIf="
                        !consultandoDNIFiador &&
                        ultimaConsultaDNIFiador ===
                          formFiador.get('documentNumber')?.value &&
                        ultimaConsultaDNIFiador.length === 8
                      "
                      class="h-4 w-4 text-green-500"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        clip-rule="evenodd"
                      ></path>
                    </svg>
                  </div>
                </div>

                <!-- Mensaje de estado DNI Fiador -->
                <div class="mt-1 text-xs">
                  <span *ngIf="consultandoDNIFiador" class="text-blue-600">
                    üîç Consultando fiador en RENIEC...
                  </span>
                  <span
                    *ngIf="
                      !consultandoDNIFiador &&
                      ultimaConsultaDNIFiador ===
                        formFiador.get('documentNumber')?.value &&
                      ultimaConsultaDNIFiador.length === 8
                    "
                    class="text-green-600"
                  >
                    ‚úÖ Datos del fiador obtenidos de RENIEC
                  </span>
                </div>
              </div>

              <div class="flex items-end">
                <button
                  type="button"
                  (click)="consultarDNIFiador()"
                  [disabled]="
                    consultandoDNIFiador ||
                    formFiador.get('documentNumber')?.value?.length !== 8
                  "
                  class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span *ngIf="!consultandoDNIFiador">üîç Consultar RENIEC</span>
                  <span *ngIf="consultandoDNIFiador">
                    <span
                      class="animate-spin inline-block h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"
                    ></span>
                    Consultando...
                  </span>
                </button>
              </div>
            </div>

            <!-- Alerta RENIEC exitoso para fiador -->
            <div
              *ngIf="
                ultimaConsultaDNIFiador ===
                  formFiador.get('documentNumber')?.value &&
                ultimaConsultaDNIFiador.length === 8
              "
              class="bg-green-50 border border-green-200 rounded-lg p-4"
            >
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <svg
                    class="h-5 w-5 text-green-400"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-green-800">
                    Datos del fiador consultados en RENIEC
                  </h3>
                  <p class="mt-1 text-sm text-green-700">
                    Los nombres y apellidos del fiador se han completado
                    autom√°ticamente desde RENIEC.
                  </p>
                </div>
              </div>
            </div>

            <!-- Datos personales del fiador -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Nombres *</label
                >
                <input
                  type="text"
                  formControlName="nombres"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Apellido Paterno *</label
                >
                <input
                  type="text"
                  formControlName="apellidoPaterno"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Apellido Materno *</label
                >
                <input
                  type="text"
                  formControlName="apellidoMaterno"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Estado Civil *</label
                >
                <select
                  formControlName="estadoCivil"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Seleccionar...</option>
                  <option value="soltero">Soltero(a)</option>
                  <option value="casado">Casado(a)</option>
                  <option value="conviviente">Conviviente</option>
                  <option value="divorciado">Divorciado(a)</option>
                  <option value="viudo">Viudo(a)</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Email *</label
                >
                <input
                  type="email"
                  formControlName="email"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Fecha de Nacimiento *</label
                >
                <input
                  type="date"
                  formControlName="fechaNacimiento"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <!-- Ubicaci√≥n del fiador -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Departamento *</label
                >
                <select
                  formControlName="departamento"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Seleccionar...</option>
                  <option *ngFor="let dep of departamentos" [value]="dep">
                    {{ dep }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Provincia *</label
                >
                <input
                  type="text"
                  formControlName="provincia"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Distrito</label
                >
                <input
                  type="text"
                  formControlName="distrito"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Direcci√≥n *</label
              >
              <input
                type="text"
                formControlName="direccion"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <!-- Contacto del fiador -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Tel√©fono Principal *</label
                >
                <input
                  type="tel"
                  formControlName="telefono1"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Tel√©fono Secundario</label
                >
                <input
                  type="tel"
                  formControlName="telefono2"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
          </form>
        </div>

        <div *ngIf="!requiereFiador" class="text-center py-12">
          <svg
            class="mx-auto h-12 w-12 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 48 48"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <h3 class="mt-4 text-lg font-medium text-gray-900">Sin fiador</h3>
          <p class="mt-2 text-sm text-gray-500">
            Esta solicitud no requiere fiador.
          </p>
        </div>
      </div>

      <!-- Paso 4: Archivos del Fiador -->
      <div *ngIf="pasoActual === 4 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Documentos del Fiador/Aval
        </h2>

        <!-- Mostrar solo si requiere fiador -->
        <div *ngIf="requiereFiador">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
        

            <!-- DNI Frente del Fiador -->
             <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosFiadorPreview['fiadorDniFrente']" class="mb-4">
              <img
                [src]="archivosFiadorPreview['fiadorDniFrente']"
                alt="Preview DNI Frente Fiador"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosFiadorPreview['fiadorDniFrente']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Dni Frente del Fiador *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelectedFiador($event, 'fiadorDniFrente')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosFiadorSeleccionados["fiadorDniFrente"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosFiadorSeleccionados['fiadorDniFrente']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosFiadorSeleccionados["fiadorDniFrente"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosFiadorSeleccionados["fiadorDniFrente"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{ formatFileSize(archivosFiadorSeleccionados["fiadorDniFrente"].size) }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivoFiador('fiadorDniFrente')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

            <!-- DNI Reverso del Fiador -->
         <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosFiadorPreview['fiadorDniReverso']" class="mb-4">
              <img
                [src]="archivosFiadorPreview['fiadorDniReverso']"
                alt="Preview DNI Reverso del Fiador"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosFiadorPreview['fiadorDniReverso']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Dni Reverso del Fiador *</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelectedFiador($event, 'fiadorDniReverso')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosFiadorSeleccionados["fiadorDniReverso"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosFiadorSeleccionados['fiadorDniReverso']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosFiadorSeleccionados["fiadorDniReverso"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosFiadorSeleccionados["fiadorDniReverso"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{ formatFileSize(archivosFiadorSeleccionados["fiadorDniReverso"].size) }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivoFiador('fiadorDniReverso')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

          
            <!-- Recibo de Servicio del Fiador (Opcional) -->
            <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
          >
            <!-- Preview de imagen si existe -->
            <div *ngIf="archivosFiadorPreview['fiadorReciboServicio']" class="mb-4">
              <img
                [src]="archivosFiadorPreview['fiadorReciboServicio']"
                alt="Preview Recibo de Servicio del Fiador"
                class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
              />
            </div>

            <!-- √çcono por defecto si no hay preview -->
            <svg
              *ngIf="!archivosFiadorPreview['fiadorReciboServicio']"
              class="mx-auto h-12 w-12 text-gray-400 mb-4"
              stroke="currentColor"
              fill="none"
              viewBox="0 0 48 48"
            >
              <path
                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>

            <label class="cursor-pointer">
              <span class="block text-sm font-medium text-gray-900 mb-1"
                >Recibo de Servicio del Fiador</span
              >
              <span class="block text-xs text-gray-500 mb-4"
                >PNG, JPG hasta 5MB</span
              >
              <input
                type="file"
                (change)="onFileSelectedFiador($event, 'fiadorReciboServicio')"
                accept="image/*"
                class="sr-only"
              />
              <span
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
              >
                {{
                  archivosFiadorSeleccionados["fiadorReciboServicio"]
                    ? "Cambiar archivo"
                    : "Seleccionar archivo"
                }}
              </span>
            </label>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div
              *ngIf="archivosFiadorSeleccionados['fiadorReciboServicio']"
              class="mt-3 p-2 bg-green-50 rounded-lg"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <span class="text-green-600">{{
                    getFileIcon(archivosFiadorSeleccionados["fiadorReciboServicio"])
                  }}</span>
                  <div class="text-sm">
                    <p class="text-green-800 font-medium">
                      {{ archivosFiadorSeleccionados["fiadorReciboServicio"].name }}
                    </p>
                    <p class="text-green-600 text-xs">
                      {{ formatFileSize(archivosFiadorSeleccionados["fiadorReciboServicio"].size) }}
                    </p>
                  </div>
                </div>
                <button
                  type="button"
                  (click)="eliminarArchivoFiador('fiadorReciboServicio')"
                  class="text-red-500 hover:text-red-700 text-sm"
                >
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>

            <!-- Foto de Fachada del Fiador (Opcional) -->
            <div
              class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"
            >
              <!-- Preview de imagen si existe -->
              <div *ngIf="archivosFiadorPreview['fiadorFachada']" class="mb-4">
                <img
                  [src]="archivosFiadorPreview['fiadorFachada']"
                  alt="Preview Fachada del Fiador"
                  class="mx-auto h-32 w-48 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
                />
              </div>

              <!-- √çcono por defecto si no hay preview -->
              <svg
                *ngIf="!archivosFiadorPreview['fiadorFachada']"
              
                class="mx-auto h-12 w-12 text-gray-400 mb-4"
                stroke="currentColor"
                fill="none"
                viewBox="0 0 48 48"
              >
                <path
                  d="M8 14v20c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252M8 14c0 4.418 7.163 8 16 8s16-3.582 16-8M8 14c0-4.418 7.163-8 16-8s16 3.582 16 8m0 0v14m-46-4v20c0 4.418 7.163 8 16 8 1.381 0 2.721-.087 4-.252"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <label class="cursor-pointer">
                <span class="block text-sm font-medium text-gray-900 mb-1"
                  >Foto de Fachada del Fiador</span
                >
                <span class="block text-xs text-gray-500 mb-4"
                  >PNG, JPG hasta 5MB (Opcional)</span
                >
                <input
                  type="file"
                  (change)="onFileSelectedFiador($event, 'fiadorFachada')"
                  accept="image/*"
                  class="sr-only"
                />
                <span
                  class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"                  
                >
                  {{
                    archivosFiadorSeleccionados["fiadorFachada"]
                      ? "Cambiar archivo"
                      : "Seleccionar archivo"
                  }}
                </span>
              </label>
              <!-- Informaci√≥n del archivo seleccionado -->
              <div
                *ngIf="archivosFiadorSeleccionados['fiadorFachada']"
                class="mt-3 p-2 bg-green-50 rounded-lg"
              >
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <span class="text-green-600">{{
                      getFileIcon(archivosFiadorSeleccionados["fiadorFachada"])
                    }}</span>
                    <div class="text-sm">
                      <p class="text-green-800 font-medium">
                        {{ archivosFiadorSeleccionados["fiadorFachada"].name }}
                      </p>
                      <p class="text-green-600 text-xs">
                        {{ formatFileSize(archivosFiadorSeleccionados["fiadorFachada"].size) }}
                      </p>
                    </div>
                  </div>
                  <button type="button" (click)="eliminarArchivoFiador('fiadorFachada')" class="text-red-500 hover:text-red-700 text-sm">
                    üóëÔ∏è Eliminar
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Informaci√≥n sobre archivos requeridos -->
          <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg
                  class="h-5 w-5 text-blue-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800">
                  Archivos del Fiador
                </h3>
                <p class="mt-1 text-sm text-blue-700">
                  Los archivos obligatorios son:
                  <strong> DNI Frente y DNI Reverso</strong>. Los dem√°s
                  documentos son opcionales pero ayudan en la evaluaci√≥n.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Mostrar si no requiere fiador -->
        <div *ngIf="!requiereFiador" class="text-center py-12">
          <svg
            class="mx-auto h-12 w-12 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 48 48"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <h3 class="mt-4 text-lg font-medium text-gray-900">Sin fiador</h3>
          <p class="mt-2 text-sm text-gray-500">
            Esta solicitud no requiere fiador, por lo que no se necesitan
            documentos adicionales.
          </p>
        </div>
      </div>

      <!-- Paso 5: Datos del Veh√≠culo -->
      <div *ngIf="pasoActual === 6 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Datos del Veh√≠culo
        </h2>

        <form [formGroup]="formVehiculo" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Marca *</label
              >
              <select
                formControlName="marca"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar marca...</option>
                <option *ngFor="let marca of marcasMotos" [value]="marca">
                  {{ marca }}
                </option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Modelo *</label
              >
              <input
                type="text"
                formControlName="modelo"
                placeholder="Ej: CB 110, FZ16, etc."
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Color *</label
              >
              <input
                type="text"
                formControlName="color"
                placeholder="Ej: Rojo, Negro, Azul, etc."
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >A√±o *</label
              >
              <select
                formControlName="anio"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar a√±o...</option>
                <option *ngFor="let year of aniosDisponibles" [value]="year">
                  {{ year }}
                </option>
              </select>
            </div>
          </div>
        </form>
      </div>

      <!-- Paso 6: Datos del Financiamiento -->
      <div *ngIf="pasoActual === 7 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Datos del Financiamiento
        </h2>

        <form [formGroup]="formSolicitud" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Precio de la Moto *</label
              >
              <div class="relative">
                <span class="absolute left-3 top-2 text-gray-500">S/.</span>
                <input
                  type="number"
                  formControlName="precioCompraMoto"
                  (input)="calcularCuota()"
                  min="1000"
                  step="100"
                  class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Inicial *</label
              >
              <div class="relative">
                <span class="absolute left-3 top-2 text-gray-500">S/.</span>
                <input
                  type="number"
                  formControlName="inicial"
                  (input)="calcularCuota()"
                  min="0"
                  step="100"
                  class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Plazo en Quincenas *</label
              >
              <select
                formControlName="plazoQuincenas"
                (change)="calcularCuota()"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Seleccionar plazo...</option>
                <option value="12">12 quincenas (6 meses)</option>
                <option value="24">24 quincenas (1 a√±o)</option>
                <option value="36">36 quincenas (1.5 a√±os)</option>
                <option value="48">48 quincenas (2 a√±os)</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Cuota Quincenal Calculada</label
              >
              <div class="relative">
                <span class="absolute left-3 top-2 text-gray-500">S/.</span>
                <input
                  type="text"
                  [value]="montoCuotaCalculado.toFixed(2)"
                  readonly
                  class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"
                />
              </div>
            </div>
          </div>

          <!-- Informaci√≥n del vendedor -->
          <div class="bg-blue-50 rounded-lg p-6">
            <h3 class="text-lg font-medium text-blue-900 mb-4">
              Informaci√≥n del Vendedor
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-blue-700 mb-2"
                  >ID Vendedor *</label
                >
                <input
                  type="text"
                  formControlName="vendedorId"
                  class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-blue-700 mb-2"
                  >Nombre del Vendedor *</label
                >
                <input
                  type="text"
                  formControlName="vendedorNombre"
                  class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-blue-700 mb-2"
                  >Tienda *</label
                >
                <input
                  type="text"
                  formControlName="vendedorTienda"
                  class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          <!-- Mensaje opcional -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Mensaje Opcional</label
            >
            <textarea
              formControlName="mensajeOpcional"
              rows="3"
              placeholder="Informaci√≥n adicional sobre la solicitud..."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            ></textarea>
          </div>

          <!-- Resumen financiero -->
          <div *ngIf="mostrarResumen" class="bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">
              Resumen del Financiamiento
            </h3>

            <div class="grid grid-cols-2 gap-4 text-sm">
              <div class="flex justify-between py-2 border-b border-gray-200">
                <span class="text-gray-600">Precio de la moto:</span>
                <span class="font-medium"
                  >S/.
                  {{ formSolicitud.get("precioCompraMoto")?.value || 0 }}</span
                >
              </div>

              <div class="flex justify-between py-2 border-b border-gray-200">
                <span class="text-gray-600">Inicial:</span>
                <span class="font-medium"
                  >S/. {{ formSolicitud.get("inicial")?.value || 0 }}</span
                >
              </div>

              <div class="flex justify-between py-2 border-b border-gray-200">
                <span class="text-gray-600">Monto a financiar:</span>
                <span class="font-medium"
                  >S/. {{ montoFinanciar.toFixed(2) }}</span
                >
              </div>

              <div class="flex justify-between py-2 border-b border-gray-200">
                <span class="text-gray-600">Plazo:</span>
                <span class="font-medium"
                  >{{
                    formSolicitud.get("plazoQuincenas")?.value || 0
                  }}
                  quincenas</span
                >
              </div>

              <div
                class="flex justify-between py-2 font-semibold text-lg col-span-2 border-t-2 border-gray-300 pt-4"
              >
                <span class="text-gray-900">Cuota quincenal:</span>
                <span class="text-blue-600"
                  >S/. {{ montoCuotaCalculado.toFixed(2) }}</span
                >
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Paso 7: Revisi√≥n Final -->
      <div *ngIf="pasoActual === 8 && !cargando">
        <h2 class="text-2xl font-semibold text-gray-900 mb-6">
          Revisi√≥n Final
        </h2>

        <!-- Resumen del titular -->
        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            üë§ Datos del Titular
          </h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <strong>Nombre:</strong> {{ formTitular.get("nombres")?.value }}
              {{ formTitular.get("apellidoPaterno")?.value }}
            </div>
            <div>
              <strong>DNI:</strong>
              {{ formTitular.get("documentNumber")?.value }}
            </div>
            <div>
              <strong>Email:</strong> {{ formTitular.get("email")?.value }}
            </div>
            <div>
              <strong>Tel√©fono:</strong>
              {{ formTitular.get("telefono1")?.value }}
            </div>
            <div>
              <strong>Ocupaci√≥n:</strong>
              {{ formTitular.get("ocupacion")?.value }}
            </div>
            <div>
              <strong>Ingresos:</strong>
              {{ formTitular.get("rangoIngresos")?.value }}
            </div>
          </div>
        </div>

        <!-- Archivos subidos -->
        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            üìÑ Archivos Subidos
          </h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div
              *ngFor="let archivo of getArchivosSubidos()"
              class="flex items-center space-x-2 py-1"
            >
              <span class="text-green-600">‚úì</span>
              <span>{{ archivo.nombre }}: {{ archivo.archivo.name }}</span>
            </div>
          </div>
        </div>

        <!-- Fiador si existe -->
        <div
          *ngIf="requiereFiador"
          class="bg-white border border-gray-200 rounded-lg p-6 mb-6"
        >
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            ü§ù Datos del Fiador
          </h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <strong>Nombre:</strong> {{ formFiador.get("nombres")?.value }}
              {{ formFiador.get("apellidoPaterno")?.value }}
            </div>
            <div>
              <strong>DNI:</strong>
              {{ formFiador.get("documentNumber")?.value }}
            </div>
            <div>
              <strong>Email:</strong> {{ formFiador.get("email")?.value }}
            </div>
            <div>
              <strong>Tel√©fono:</strong>
              {{ formFiador.get("telefono1")?.value }}
            </div>
          </div>
        </div>
        <!-- Agregar secci√≥n de archivos del fiador en la revisi√≥n -->
        <div
          *ngIf="requiereFiador && archivosFiadorSeleccionados"
          class="bg-white border border-gray-200 rounded-lg p-6 mb-6"
        >
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            üìÑ Archivos del Fiador
          </h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div
              *ngFor="let archivo of getArchivosFiadorSubidos()"
              class="flex items-center space-x-2 py-1"
            >
              <span class="text-green-600">‚úì</span>
              <span>{{ archivo.nombre }}: {{ archivo.archivo.name }}</span>
            </div>
          </div>
        </div>

        <!-- Referencias -->
        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            üë• Referencias
          </h3>
          <div
            *ngFor="
              let ref of getReferenciasFormArray().controls;
              let i = index
            "
            class="mb-3 p-3 bg-gray-50 rounded text-sm"
          >
            <div class="grid grid-cols-2 gap-4">
              <div>
                <strong
                  >{{ i + 1 }}. {{ ref.get("nombre")?.value }}
                  {{ ref.get("apellidos")?.value }}</strong
                >
              </div>
              <div>{{ ref.get("parentesco")?.value }}</div>
              <div>{{ ref.get("telefono")?.value }}</div>
            </div>
          </div>
        </div>

        <!-- Veh√≠culo -->
        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">üèçÔ∏è Veh√≠culo</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <strong>Marca:</strong> {{ formVehiculo.get("marca")?.value }}
            </div>
            <div>
              <strong>Modelo:</strong> {{ formVehiculo.get("modelo")?.value }}
            </div>
            <div>
              <strong>Color:</strong> {{ formVehiculo.get("color")?.value }}
            </div>
            <div>
              <strong>A√±o:</strong> {{ formVehiculo.get("anio")?.value }}
            </div>
          </div>
        </div>

        <!-- Financiamiento -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-blue-900 mb-4">
            üí∞ Financiamiento
          </h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <strong>Precio:</strong> S/.
              {{ formSolicitud.get("precioCompraMoto")?.value || 0 }}
            </div>
            <div>
              <strong>Inicial:</strong> S/.
              {{ formSolicitud.get("inicial")?.value || 0 }}
            </div>
            <div>
              <strong>Plazo:</strong>
              {{ formSolicitud.get("plazoQuincenas")?.value || 0 }} quincenas
            </div>
            <div>
              <strong>Cuota:</strong> S/. {{ montoCuotaCalculado.toFixed(2) }}
            </div>
            <div class="col-span-2">
              <strong>Vendedor:</strong>
              {{ formSolicitud.get("vendedorNombre")?.value }} -
              {{ formSolicitud.get("vendedorTienda")?.value }}
            </div>
          </div>
        </div>

        <!-- T√©rminos y condiciones -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
          <label class="flex items-start">
            <input
              type="checkbox"
              [(ngModel)]="aceptaTerminos"
              class="mt-1 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
            />
            <span class="ml-3 text-sm text-gray-700">
              <strong>Acepto los t√©rminos y condiciones</strong><br />
              He revisado toda la informaci√≥n ingresada y confirmo que es
              correcta. Entiendo que esta informaci√≥n ser√° utilizada para
              evaluar mi solicitud de financiamiento.
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- Botones de navegaci√≥n -->
    <div class="bg-white rounded-lg shadow-sm p-6 mt-6">
      <div class="flex justify-between">
        <button
          type="button"
          (click)="pasoAnterior()"
          [disabled]="pasoActual === 1 || cargando"
          class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ‚Üê Anterior
        </button>

        <div class="flex space-x-4">
          <button
            type="button"
            (click)="guardarBorrador()"
            [disabled]="cargando"
            class="px-6 py-2 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            üíæ Guardar Borrador
          </button>

          <button
            type="button"
            (click)="siguientePaso()"
            [disabled]="!puedeAvanzar() || cargando"
            *ngIf="pasoActual < totalPasos"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Siguiente ‚Üí
          </button>

          <button
            type="button"
            (click)="enviarSolicitud()"
            [disabled]="!puedeEnviar() || cargando"
            *ngIf="pasoActual === totalPasos"
            class="px-8 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            üöÄ Enviar Solicitud
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de √©xito -->
    <div
      *ngIf="mostrarModalExito"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
    >
      <div
        class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
      >
        <div class="mt-3 text-center">
          <div
            class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"
          >
            <svg
              class="h-6 w-6 text-green-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
          </div>
          <h3 class="text-lg leading-6 font-medium text-gray-900 mt-4">
            ¬°Solicitud Enviada Exitosamente!
          </h3>
          <div class="mt-2 px-7 py-3">
            <p class="text-sm text-gray-500">
              Su solicitud de financiamiento ha sido enviada correctamente.
              Recibir√° un correo de confirmaci√≥n y le contactaremos pronto.
            </p>
            <p class="text-xs text-gray-400 mt-2">
              N√∫mero de solicitud: {{ numeroSolicitud }}
            </p>
          </div>
          <div class="items-center px-4 py-3">
            <button
              (click)="cerrarModal()"
              class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700"
            >
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
